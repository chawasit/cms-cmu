{% from cms.grading import task_score %}{% from cms.db import Session, Contest, User, Task, Submission %}{% set sql_session = Session() %}{% set contest_list = sorted(sql_session.query(Contest).all(), key=lambda c: c.id) %}{% set user_list = sorted(contest.users, key=lambda u: u.id) %}{{ "Username" }},{{ "User"  }},{% for c_iter in contest_list %}{% if str(c_iter.id) in contest_select %}{% for task in c_iter.tasks %}{{ task.name }},{% end %}{{ "%s Total" % c_iter.name }},{% end %}{% end %}{{ "Global" }}
{% for user in user_list %}{% if not user.hidden %}{% if str(user.id) in user_select %}{% set total_score = 0.0 %}{{ user.username }},{{ "%s %s" % (user.first_name, user.last_name) }},{% for c_iter in contest_list %}{% if str(c_iter.id) in contest_select %}{% set score = 0.0 %}{% set partial = False %}{% for task in c_iter.tasks %}{% set t_score, t_partial = task_score(user, task) %}{% set t_score = round(t_score, task.score_precision) %}{% set score += t_score %}{% set total_score += t_score %}{% set partial = partial or t_partial %}{{ t_score }}{% if t_partial %}*{% end %},{% end %}{{ round(score, c_iter.score_precision) }}{% if partial %}*{% end %},{% end %}{% end %}{{ total_score }}
{% end %}{% end %}{% end %}
